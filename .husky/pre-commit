#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Check commit message first
commit_msg=$(git log -1 --pretty=%B)
if ! echo "$commit_msg" | grep -qE "^(feat|fix|refactor|chore|docs|test|style): "; then
  echo "❌ Invalid commit message!"
  echo "Commit must start with one of: feat:, fix:, refactor:, chore:, docs:, test:, style: (lowercase)"
  exit 1
fi

# Run tests
pnpm run test:ci || {
  echo "❌ Tests failed. Commit aborted."
  exit 1
}

# Run formatting/linting (optional)
# pnpm exec biome check --write || {
#   echo "❌ Linting failed. Commit aborted."
#   exit 1
# }

echo "✅ Pre-commit checks passed."
